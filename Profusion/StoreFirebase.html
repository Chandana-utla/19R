<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Upload Example</title>

    <!-- Firebase SDK modules (use module script type) -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.19.0/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.19.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.19.0/firebase-storage.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDHEcml3aP5X8H6iY3qNnjmoIYKE6WZ4Cc",
            authDomain: "profusion-55ee5.firebaseapp.com",
            projectId: "profusion-55ee5",
            storageBucket: "profusion-55ee5.appspot.com",
            messagingSenderId: "705597166854",
            appId: "1:705597166854:web:f714caa1b9141a93353a87"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // Function to preview file before uploading
        window.previewFile = function(event) {
            const preview = document.getElementById('filePreview');
            const file = event.target.files[0];

            if (file) {
                const fileURL = URL.createObjectURL(file); // Create a Blob URL
                preview.src = fileURL;  // Set the preview image source
                preview.style.display = 'block';  // Show the preview image
            }
        };

        // Function to upload content (thoughts + file)
        window.uploadContent = async function() {
            const creatorName = document.getElementById('creatorName').value.trim();
            const userThoughts = document.getElementById('creatorThoughts').value.trim();
            const file = document.getElementById('contentFile').files[0];

            if (!creatorName) {
                alert("Please enter your name!");
                return;
            }

            if (!userThoughts && !file) {
                alert("Please write your thoughts or upload a file!");
                return;
            }

            let fileURL = null;
            let fileName = "No file uploaded";

            if (file) {
                try {
                    // Upload the file to Firebase Storage
                    const storageRef = ref(storage, 'uploads/' + file.name);
                    await uploadBytes(storageRef, file);
                    fileURL = await getDownloadURL(storageRef); // Get the URL of the uploaded file
                    fileName = file.name;
                } catch (error) {
                    console.error("Error uploading file:", error.message);
                    alert("Failed to upload file. Please try again.");
                    return;
                }
            }

            // Save content data to Firestore
            try {
                await addDoc(collection(db, "contents"), {
                    creatorName,
                    thoughts: userThoughts,
                    fileName,
                    fileURL,
                    timestamp: new Date().toISOString()
                });
                alert("Content uploaded successfully!");
                document.getElementById('creatorName').value = "";
                document.getElementById('creatorThoughts').value = "";
                document.getElementById('contentFile').value = "";
                document.getElementById('filePreview').style.display = 'none'; // Hide preview
            } catch (error) {
                console.error("Error saving content to Firestore:", error.message);
                alert("Failed to upload content. Please try again.");
            }
        };
    </script>
</head>

<body>
    <h2>Upload Your Thoughts and Attachments</h2>
    <div>
        <label for="creatorName">Your Name:</label>
        <input type="text" id="creatorName" placeholder="Enter your name">
    </div>

    <div>
        <label for="creatorThoughts">Your Thoughts:</label>
        <textarea id="creatorThoughts" placeholder="Share your thoughts..."></textarea>
    </div>

    <div>
        <label for="contentFile">Upload File:</label>
        <input type="file" id="contentFile" onchange="previewFile(event)">
    </div>

    <div>
        <img id="filePreview" style="display:none; max-width: 100px;" />
    </div>

    <button onclick="uploadContent()">Upload</button>
</body>

</html>
